<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevHub AI - Modern Edition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lucide-static@latest/dist/lucide.min.js"></script>

    <style>
        /* --- THEME & COLOR SYSTEM --- */
        :root {
            --ease-in-out: all 0.3s ease-in-out;
            
            /* Light Theme (Default) */
            --bg-primary: #F9FAFB;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F3F4F6;
            --bg-accent: #4F46E5;
            --bg-accent-light: #EEF2FF;

            --border-primary: #E5E7EB;
            --border-secondary: #F3F4F6;
            
            --text-primary: #111827;
            --text-secondary: #374151;
            --text-muted: #6B7280;
            --text-accent: #4338CA;
            --text-on-accent: #FFFFFF;

            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        body.dark-theme {
            /* Dark Theme */
            --bg-primary: #111827;
            --bg-secondary: #1F2937;
            --bg-tertiary: #374151;
            --bg-accent: #6366F1;
            --bg-accent-light: #3730A3;

            --border-primary: #374151;
            --border-secondary: #4B5563;

            --text-primary: #F9FAFB;
            --text-secondary: #D1D5DB;
            --text-muted: #9CA3AF;
            --text-accent: #A5B4FC;
            --text-on-accent: #FFFFFF;
        }

        /* Base and Reset */
        body { margin: 0; font-family: 'Inter', sans-serif; background-color: var(--bg-primary); color: var(--text-secondary); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; transition: var(--ease-in-out); line-height: 1.6; }
        h1, h2, h3, h4, h5, h6 { color: var(--text-primary); font-weight: 700; }
        
        /* Layout */
        .app-container { display: flex; height: 100vh; }
        .main-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .main-content { flex: 1; overflow-y: auto; padding: 2rem; }

        /* Sidebar */
        .sidebar { width: 256px; background-color: var(--bg-secondary); border-right: 1px solid var(--border-primary); display: flex; flex-direction: column; transition: width 0.3s ease, var(--ease-in-out); flex-shrink: 0; }
        .sidebar-header { display: flex; align-items: center; height: 65px; padding: 0 1rem; border-bottom: 1px solid var(--border-primary); flex-shrink: 0; }
        .sidebar-header-title { margin-left: 0.75rem; font-size: 1.125rem; color: var(--text-primary); }
        .sidebar-nav { flex: 1; padding: 0.5rem; }
        .sidebar-nav ul { list-style: none; padding: 0; margin: 0; }
        .sidebar-nav a { display: flex; align-items: center; padding: 0.6rem 0.75rem; margin: 0.25rem 0; border-radius: 0.5rem; color: var(--text-muted); text-decoration: none; font-weight: 500; transition: all 0.2s ease; }
        .sidebar-nav a:hover { background-color: var(--bg-tertiary); color: var(--text-primary); }
        .sidebar-nav a.active { background-color: var(--bg-accent); color: var(--text-on-accent); box-shadow: var(--shadow-sm); }
        .sidebar-nav a .lucide { margin-right: 0.75rem; }
        
        /* Header */
        .header { height: 65px; background-color: var(--bg-secondary); border-bottom: 1px solid var(--border-primary); display: flex; align-items: center; justify-content: space-between; padding: 0 2rem; flex-shrink: 0; transition: var(--ease-in-out); }
        .header-search { position: relative; width: 100%; max-width: 600px; }
        .header-search input { width: 100%; padding: 0.8rem 1rem 0.8rem 3rem; font-size: 1rem; background-color: var(--bg-tertiary); border: 1px solid var(--border-primary); border-radius: 0.5rem; color: var(--text-primary); transition: var(--ease-in-out); }
        .header-search input:focus { background-color: var(--bg-secondary); border-color: var(--bg-accent); box-shadow: 0 0 0 2px var(--bg-accent-light); outline: none; }
        .header-search .lucide-search { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-muted); width: 20px; height: 20px; }
        .header-user { display: flex; align-items: center; gap: 1rem; }
        .theme-toggle { background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 0.5rem; border-radius: 99px; }
        .theme-toggle:hover { color: var(--text-primary); background-color: var(--bg-tertiary); }
        .header-user img { width: 36px; height: 36px; border-radius: 9999px; border: 2px solid var(--border-primary); }

        /* General Card Style */
        .card { background-color: var(--bg-secondary); border-radius: 0.75rem; border: 1px solid var(--border-primary); box-shadow: var(--shadow-sm); transition: var(--ease-in-out); overflow: hidden; }
        .card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }
        
        /* Project Card Specifics */
        .project-card { display: flex; flex-direction: column; cursor: pointer; }
        .project-card-body { padding: 1.5rem; flex-grow: 1; }
        .project-card-footer { padding: 1rem 1.5rem; background-color: var(--bg-primary); border-top: 1px solid var(--border-primary); transition: var(--ease-in-out); }
        .project-card-title { font-size: 1.125rem; font-weight: 600; margin: 0 0 0.5rem; }
        .project-card-description { font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 1.25rem; min-height: 50px; }
        .project-card-heading { font-size: 0.75rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin: 0 0 0.5rem; }
        
        /* Tags & Badges */
        .tech-tag { display: inline-block; padding: 0.25rem 0.6rem; font-size: 0.75rem; font-weight: 500; background-color: var(--bg-tertiary); color: var(--text-secondary); border-radius: 0.375rem; }
        .status-badge { padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 600; border-radius: 9999px; }
        .status-ongoing { background-color: #DBEAFE; color: #1E40AF; }
        .status-completed { background-color: #D1FAE5; color: #065F46; }
        .status-minor { background-color: #FEF9C3; color: #854D0E; }
        body.dark-theme .status-ongoing { background-color: #1E40AF; color: #DBEAFE; }
        body.dark-theme .status-completed { background-color: #166534; color: #D1FAE5; }
        body.dark-theme .status-minor { background-color: #854D0E; color: #FEF9C3; }

        /* Other Component Styles */
        .lesson-card-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border-primary); }
        .lesson-card-header h4 { font-size: 1.125rem; margin: 0; display: flex; align-items: center; gap: 0.75rem; }
        .lesson-card-body { padding: 1.5rem; font-size: 0.95rem; }
        .lesson-card-footer { padding: 0 1.5rem 1.25rem; font-size: 0.8rem; color: var(--text-muted); }
        .lesson-card-footer span { font-weight: 600; color: var(--text-accent); }
        .chat-container { display: flex; flex-direction: column; height: 100%; max-width: 800px; margin: 0 auto; background-color: var(--bg-secondary); border-radius: 0.75rem; box-shadow: var(--shadow-md); border: 1px solid var(--border-primary); }
        .chat-messages { flex-grow: 1; padding: 1.5rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; }
        .message { max-width: 80%; padding: 0.75rem 1rem; border-radius: 1rem; line-height: 1.5; }
        .bot-message { background-color: var(--bg-tertiary); color: var(--text-secondary); border-bottom-left-radius: 0.25rem; align-self: flex-start; }
        .user-message { background-color: var(--bg-accent); color: var(--text-on-accent); border-bottom-right-radius: 0.25rem; align-self: flex-end; }
        .pre-chat-prompts { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-primary); display: flex; flex-wrap: wrap; gap: 0.75rem; }
        .prompt-button { background-color: transparent; border: 1px solid var(--border-primary); color: var(--text-accent); padding: 0.5rem 1rem; border-radius: 99px; font-size: 0.875rem; cursor: pointer; transition: var(--ease-in-out); }
        .prompt-button:hover { background-color: var(--bg-accent-light); border-color: var(--text-accent); }
        .chat-input-area { display: flex; gap: 0.75rem; padding: 1rem; border-top: 1px solid var(--border-primary); }
        .chat-input-area input { flex-grow: 1; padding: 0.75rem 1rem; border: 1px solid var(--border-primary); background-color: var(--bg-primary); border-radius: 0.5rem; font-size: 1rem; color: var(--text-primary); }
        .chat-input-area input:focus { border-color: var(--bg-accent); box-shadow: 0 0 0 2px var(--bg-accent-light); outline: none; }
        .chat-input-area button { background-color: var(--bg-accent); color: var(--text-on-accent); border: none; padding: 0.75rem 1.25rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: var(--ease-in-out); }
        .chat-input-area button:hover { opacity: 0.9; }
        .typing-indicator span { height: 8px; width: 8px; background-color: var(--text-muted); border-radius: 50%; display: inline-block; animation: wave 1.3s infinite; }
        .typing-indicator span:nth-of-type(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-of-type(3) { animation-delay: 0.4s; }
        @keyframes wave { 0%, 60%, 100% { transform: initial; } 30% { transform: translateY(-8px); } }
        .back-button { background: none; border: none; color: var(--text-accent); font-weight: 600; font-size: 0.875rem; cursor: pointer; display: flex; align-items: center; gap: 0.25rem; padding: 0.5rem; margin-left: -0.5rem; margin-bottom: 1rem; border-radius: 0.375rem; }
        .back-button:hover { background-color: var(--bg-tertiary); }

        /* Responsive */
        @media (max-width: 768px) { .sidebar { width: 0; overflow: hidden; border: none; padding: 0; } }
    </style>
</head>
<body>
    <div id="app" class="app-container"></div>

    <script>
    // --- MOCK DATA ---
    const mockProjects = [
      { id: 1, name: 'Project Phoenix', status: 'Ongoing', description: 'Next-generation e-commerce platform with AI-powered recommendations.', techStack: ['React', 'Node.js', 'PostgreSQL', 'AWS Lambda', 'AWS Cognito'], team: [1, 2, 3], jiraStatus: { stories: 25, bugs: 5, blockers: 1, progress: 60 }, lessons: [{id: 1, title: 'Optimizing PostgreSQL full-text search', solvedBy: 2, details: 'Initial implementation of FTS was slow. Solution involved creating a dedicated GIN index and using tsvector triggers.'}, {id: 2, title: 'Cognito Cold Start Issues', solvedBy: 1, details: 'Lambda authorizers for Cognito had significant cold starts. Solution: Provisioned concurrency and simplified JWT validation logic.'}], standards: { naming: 'camelCase for variables, PascalCase for components.', spacing: '2 spaces for indentation.', structure: 'Feature-sliced directory structure.' } },
      { id: 2, name: 'QuantumLeap Analytics', status: 'Completed', description: 'Data processing pipeline for real-time user behavior analytics.', techStack: ['Python', 'Apache Spark', 'Kafka', 'n8n', 'BigQuery'], team: [4, 5], jiraStatus: { stories: 40, bugs: 2, blockers: 0, progress: 100 }, lessons: [{id: 3, title: 'Kafka consumer group rebalancing storms', solvedBy: 4, details: 'Frequent rebalancing caused processing delays. Tuned session.timeout.ms and heartbeat.interval.ms to stabilize consumers.'}], standards: { naming: 'snake_case for variables and functions.', spacing: '4 spaces for indentation.', structure: 'Standard Python module layout.' } },
      { id: 3, name: 'Internal Tools Automation', status: 'Ongoing', description: 'Automating developer onboarding and access management using n8n workflows.', techStack: ['n8n', 'Okta API', 'Jira API'], team: [1, 5], jiraStatus: { stories: 15, bugs: 1, blockers: 0, progress: 80 }, lessons: [{id: 4, title: 'Handling Okta API rate limits', solvedBy: 5, details: 'Bulk operations were hitting rate limits. Implemented exponential backoff with jitter in the n8n workflow.'}], standards: { naming: 'Default n8n node naming conventions.', spacing: 'N/A', 'structure': 'One workflow per major process.' } },
      { id: 4, name: 'Mobile App Refactor', status: 'Minor Initiative', description: 'Refactoring the legacy mobile app codebase to use modern frameworks.', techStack: ['React Native', 'TypeScript', 'Firebase'], team: [2, 3], jiraStatus: { stories: 30, bugs: 8, blockers: 2, progress: 25 }, lessons: [], standards: { naming: 'camelCase', spacing: '2 spaces', structure: 'Component-based structure.' } },
    ];
    const mockDevelopers = [
      { id: 1, name: 'Alice Johnson', role: 'Tech Lead', avatar: 'https://placehold.co/100x100/E2D9FF/4F46E5?text=AJ', skills: ['React', 'Node.js', 'AWS Lambda', 'n8n', 'Jira API'], projects: [1, 3] },
      { id: 2, name: 'Bob Williams', role: 'Frontend Developer', avatar: 'https://placehold.co/100x100/D1FAE5/065F46?text=BW', skills: ['React', 'React Native', 'TypeScript', 'PostgreSQL'], projects: [1, 4] },
      { id: 3, name: 'Charlie Brown', role: 'Backend Developer', avatar: 'https://placehold.co/100x100/FEF3C7/92400E?text=CB', skills: ['Node.js', 'PostgreSQL', 'AWS Cognito', 'Firebase'], projects: [1, 4] },
      { id: 4, name: 'Diana Prince', role: 'Data Engineer', avatar: 'https://placehold.co/100x100/FEE2E2/991B1B?text=DP', skills: ['Python', 'Apache Spark', 'Kafka', 'BigQuery'], projects: [2] },
      { id: 5, name: 'Ethan Hunt', role: 'DevOps Engineer', avatar: 'https://placehold.co/100x100/E0E7FF/3730A3?text=EH', skills: ['n8n', 'Okta API', 'Python', 'Kafka'], projects: [2, 3] },
    ];

    const predefinedAnswers = {
        "Summarize Project Phoenix": "Project Phoenix is our next-generation e-commerce platform featuring AI-powered recommendations. The current team includes Alice Johnson, Bob Williams, and Charlie Brown. ðŸš€",
        "Who is an expert in Python?": "Diana Prince (Data Engineer) and Ethan Hunt (DevOps Engineer) are our primary Python experts.",
        "What was the Cognito cold start issue?": "We learned that Lambda authorizers for Cognito had significant cold starts. The solution was to implement Provisioned Concurrency and simplify our JWT validation logic. This was on Project Phoenix.",
        "Which project uses n8n?": "Two projects use n8n: 'QuantumLeap Analytics' for its data processing pipeline and 'Internal Tools Automation' for managing developer access. âš™ï¸"
    };

    const predefinedProjects = {
        "E-commerce Backend": "We need a robust backend for our e-commerce site. Key technologies will be Node.js for the API, PostgreSQL for the database, and AWS Cognito for user authentication.",
        "Mobile App Refresh": "We are refreshing our mobile application and need a team skilled in modern frontend frameworks like React and React Native, with some backend knowledge of Firebase.",
        "Data Analytics Pipeline": "The goal is to build a high-throughput data pipeline. We need data engineers with strong Python skills and experience with stream processing tools like Apache Spark and Kafka."
    };
    
    let state = { currentPage: 'hub', selectedProject: null, recommendedTeam: null, searchTerm: '', searchResults: null, chatHistory: [] };

    const themeManager = {
        init() { this.toggleButton = null; const savedTheme = localStorage.getItem('theme') || 'light'; document.body.classList.toggle('dark-theme', savedTheme === 'dark'); this.updateIcon(savedTheme); },
        bind(button) { this.toggleButton = button; this.toggleButton.addEventListener('click', () => this.toggleTheme()); this.updateIcon(document.body.classList.contains('dark-theme') ? 'dark' : 'light'); },
        toggleTheme() { const isDark = document.body.classList.toggle('dark-theme'); const newTheme = isDark ? 'dark' : 'light'; localStorage.setItem('theme', newTheme); this.updateIcon(newTheme); },
        updateIcon(theme) { if (this.toggleButton) { this.toggleButton.innerHTML = theme === 'dark' ? getIcon('sun') : getIcon('moon'); } }
    };

    const getIcon = (name, options = {}) => { const { size = 20, className = '' } = options; return `<i data-lucide="${name}" class="lucide ${className}" style="width:${size}px; height:${size}px;"></i>`; };

    const AppShellHTML = `
        <nav class="sidebar">
            <div class="sidebar-header">${getIcon('brain-circuit', { size: 28 })}<span class="sidebar-header-title">DevHub AI</span></div>
            <nav class="sidebar-nav">
                <ul>
                    ${['hub', 'developer-dashboard', 'team-builder', 'ai-chat'].map(pageId => {
                        const labels = { hub: 'Project Hub', 'developer-dashboard': 'Developer Dashboard', 'team-builder': 'Team Builder', 'ai-chat': 'AI Chat' };
                        const icons = { hub: 'folder-kanban', 'developer-dashboard': 'users', 'team-builder': 'users-plus', 'ai-chat': 'message-circle' };
                        return `<li><a href="#" class="nav-link" data-page="${pageId}">${getIcon(icons[pageId])}<span>${labels[pageId]}</span></a></li>`;
                    }).join('')}
                </ul>
            </nav>
        </nav>
        <div class="main-container">
            <header class="header">
                <form id="search-form" class="header-search">
                    ${getIcon('search', { className: 'lucide-search' })}<input type="text" id="search-input" placeholder="Search for experts, lessons, or tech...">
                </form>
                <div class="header-user">
                    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme"></button>
                    ${getIcon('bell')}<img src="https://placehold.co/100x100/E0E7FF/3730A3?text=AL" alt="User">
                </div>
            </header>
            <main class="main-content" id="page-content"></main>
        </div>
    `;

    // --- PAGE CONTENT GENERATORS ---
    const ProjectHubPage = () => `<div><h1 style="font-size: 1.875rem; margin-bottom: 2rem;">Project Hub</h1><div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">${mockProjects.map(project => `<div class="card project-card" data-project-id="${project.id}"><div class="project-card-body"><div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;"><h3 class="project-card-title">${project.name}</h3><span class="status-badge ${project.status === 'Ongoing' ? 'status-ongoing' : project.status === 'Completed' ? 'status-completed' : 'status-minor'}">${project.status}</span></div><p class="project-card-description">${project.description}</p><h4 class="project-card-heading">Tech Stack</h4><div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">${project.techStack.slice(0, 4).map(tech => `<span class="tech-tag">${tech}</span>`).join('')}</div></div><div class="project-card-footer"><h4 class="project-card-heading">Team</h4><div style="display: flex; ">${project.team.map(devId => `<img src="${mockDevelopers.find(d => d.id === devId).avatar}" title="${mockDevelopers.find(d => d.id === devId).name}" style="height: 32px; width: 32px; border-radius: 9999px; border: 2px solid var(--bg-secondary); margin-left: -0.5rem;"/>`).join('')}</div></div></div>`).join('')}</div></div>`;
    const DeveloperDashboardPage = () => `<div><h1 style="font-size: 1.875rem; margin-bottom: 2rem;">Developer Dashboard</h1><div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">${mockDevelopers.map(dev => `<div class="card" style="padding: 1.5rem; text-align: center;"><img src="${dev.avatar}" style="width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 1rem; border: 4px solid var(--border-primary);"><h3 style="font-size: 1.25rem; margin: 0;">${dev.name}</h3><p style="color: var(--text-muted); margin: 0.25rem 0 1rem;">${dev.role}</p><div style="display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center;">${dev.skills.map(skill => `<span class="tech-tag">${skill}</span>`).join('')}</div></div>`).join('')}</div></div>`;
    const AiAssistantPage = () => { if (!state.searchResults) return `<div style="text-align: center; padding: 5rem 0;"><h3 style="font-size: 1.25rem;">Search to find experts and solutions.</h3></div>`; const { experts, lessons } = state.searchResults; return `<div><h1 style="font-size: 1.875rem; margin-bottom: 2.5rem;">Results for: <span style="color: var(--text-accent);">${state.searchTerm}</span></h1><div style="margin-bottom: 2.5rem;"><h2 style="font-size: 1.5rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">${getIcon('star')}Identified Experts</h2>${experts.length ? `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem;">${experts.map(dev => `<div class="card" style="padding: 1.5rem; text-align: center;"><img src="${dev.avatar}" style="width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 1rem; border: 4px solid var(--border-primary);"><h3 style="font-size: 1.125rem; margin: 0;">${dev.name}</h3><p style="color: var(--text-muted); margin: 0.25rem 0 0;">${dev.role}</p></div>`).join('')}</div>` : '<p>No experts found for this query.</p>'}</div><div><h2 style="font-size: 1.5rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">${getIcon('book-marked')}Related Lessons Learned</h2><div style="display: flex; flex-direction: column; gap: 1.5rem;">${lessons.length ? lessons.map(lesson => `<div class="card lesson-card"><div class="lesson-card-header"><h4>${getIcon('lightbulb')} ${lesson.title}</h4></div><div class="lesson-card-body"><p>${lesson.details}</p></div><div class="lesson-card-footer">From Project: <span>${lesson.projectName}</span></div></div>`).join('') : '<p>No lessons found for this query.</p>'}</div></div></div>`; };
    const AiChatPage = () => { const prompts = Object.keys(predefinedAnswers); return `<div class="chat-container"><div class="chat-messages" id="chat-messages"></div><div class="pre-chat-prompts">${prompts.map(p => `<button class="prompt-button">${p}</button>`).join('')}</div><form class="chat-input-area" id="chat-form"><input type="text" id="chat-input" placeholder="Ask a question..." autocomplete="off"><button type="submit">${getIcon('send')}</button></form></div>`; };
    const ProjectDetailPage = (project) => { const getStatusClass = (status) => (status === 'Ongoing' ? 'status-ongoing' : status === 'Completed' ? 'status-completed' : 'status-minor'); return `<div><button class="back-button" id="back-to-hub">${getIcon('arrow-left', {size: 16})} Back to Project Hub</button><div class="card" style="padding: 2rem; margin-bottom: 1.5rem;"><div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;"><h1 style="font-size: 1.875rem; margin: 0;">${project.name}</h1><span class="status-badge ${getStatusClass(project.status)}">${project.status}</span></div><p style="color: var(--text-secondary); max-width: 65ch;">${project.description}</p></div><div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;"><div class="card" style="padding: 1.5rem;"><h3 class="project-card-heading">Team Members</h3><ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 1rem;">${project.team.map(devId => { const dev = mockDevelopers.find(d => d.id === devId); return `<li style="display: flex; align-items: center; gap: 0.75rem;"><img src="${dev.avatar}" style="width: 40px; height: 40px; border-radius: 50%;"><div><p style="font-weight: 600; color: var(--text-primary); margin: 0;">${dev.name}</p><p style="color: var(--text-muted); margin: 0; font-size: 0.875rem;">${dev.role}</p></div></li>`; }).join('')}</ul></div><div class="card" style="padding: 1.5rem;"><h3 class="project-card-heading">Technology Stack</h3><div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">${project.techStack.map(tech => `<span class="tech-tag">${tech}</span>`).join('')}</div></div></div><div><h2 style="font-size: 1.5rem; margin-bottom: 1rem;">Lessons Learned</h2><div style="display: flex; flex-direction: column; gap: 1rem;">${project.lessons.length ? project.lessons.map(lesson => `<div class="card lesson-card"><div class="lesson-card-header"><h4>${getIcon('lightbulb')} ${lesson.title}</h4></div><div class="lesson-card-body"><p>${lesson.details}</p></div></div>`).join('') : '<div class="card" style="padding: 1.5rem;"><p style="color: var(--text-muted);">No lessons have been documented for this project yet.</p></div>'}</div></div></div>`; };
    const TeamBuilderPage = () => { let resultsHtml = `<p style="text-align: center; color: var(--text-muted); padding: 2rem 0;">Your recommended team will appear here.</p>`; if (state.recommendedTeam) { resultsHtml = `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1.5rem;">${state.recommendedTeam.map(dev => `<div class="card" style="padding: 1.5rem; text-align: center;"><img src="${dev.avatar}" style="width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 1rem; border: 4px solid var(--border-primary);"><h3 style="font-size: 1.125rem; margin: 0;">${dev.name}</h3><p style="color: var(--text-muted); margin: 0.25rem 0 1rem;">${dev.role}</p><div style="font-size: 0.75rem; color: var(--text-muted);"><strong>Skills:</strong> ${dev.matchedSkills.join(', ')}</div></div>`).join('')}</div>`; } return `<div><h1 style="font-size: 1.875rem; margin-bottom: 0.5rem;">AI Team Builder</h1><p style="color: var(--text-muted); max-width: 65ch; margin-bottom: 2rem;">Describe your project requirements, and the AI will assemble a cost-effective team of five. Or, try one of our sample project descriptions.</p><div class="card" style="padding: 1.5rem; margin-bottom: 2.5rem;"><h2 style="font-size: 1.25rem; margin-top: 0; margin-bottom: 1rem;">Start with a Sample Project</h2><div id="team-builder-prompts" class="pre-chat-prompts" style="padding: 0; border: none; margin-bottom: 1.5rem;">${Object.keys(predefinedProjects).map(p => `<button class="prompt-button team-prompt-button" data-prompt-key="${p}">${p}</button>`).join('')}</div><form id="team-builder-form"><label for="project-description-input" style="font-weight: 600; color: var(--text-primary); display: block; margin-bottom: 0.5rem;">Describe your project requirements below</label><textarea id="project-description-input" rows="5" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-primary); background-color: var(--bg-primary); border-radius: 0.5rem; font-size: 1rem; color: var(--text-primary); margin-bottom: 1rem; box-sizing: border-box;"></textarea><button type="submit" style="background-color: var(--bg-accent); color: var(--text-on-accent); border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: var(--ease-in-out); display: flex; align-items: center; gap: 0.5rem;">${getIcon('users-plus')} Build My Team</button></form></div><div><h2 style="font-size: 1.5rem; margin-bottom: 1.5rem;">Recommended Team</h2><div id="team-results">${resultsHtml}</div></div></div>`; };
    
    // --- LOGIC FUNCTIONS ---
    function renderChatView() { const chatMessagesEl = document.getElementById('chat-messages'); if (!chatMessagesEl) return; let html = ''; if (state.chatHistory.length === 0) { html += '<div class="message bot-message">Hello! How can I help you navigate our DevHub today? Try one of the prompts below.</div>'; } html += state.chatHistory.map(msg => `<div class="message ${msg.from}-message">${msg.text}</div>`).join(''); chatMessagesEl.innerHTML = html; chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight; }
    function handleChatMessage(query) { if (!query) return; state.chatHistory.push({ from: 'user', text: query }); renderChatView(); const chatMessagesEl = document.getElementById('chat-messages'); const typingIndicator = document.createElement('div'); typingIndicator.id = 'typing-indicator'; typingIndicator.className = 'message bot-message typing-indicator'; typingIndicator.innerHTML = `<span></span><span></span><span></span>`; chatMessagesEl.appendChild(typingIndicator); chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight; setTimeout(() => { document.getElementById('typing-indicator')?.remove(); let response = predefinedAnswers[query] || "I'm sorry, for this demonstration I can only answer one of the suggested questions. Please try clicking a prompt!"; state.chatHistory.push({ from: 'bot', text: response.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') }); renderChatView(); }, 1200); }
    
    // REFACTORED: generateTeam is now synchronous.
    function generateTeam(description) {
        console.log("LOG: [generateTeam] Starting team calculation...");
        try {
            const allPossibleSkills = [...new Set(mockDevelopers.flatMap(dev => dev.skills))];
            const requiredSkills = allPossibleSkills.filter(skill => description.toLowerCase().includes(skill.toLowerCase()));
            const roleCost = { 'Tech Lead': 3, 'Data Engineer': 2.5, 'DevOps Engineer': 2, 'Backend Developer': 1.5, 'Frontend Developer': 1.5 };
            const scoredDevs = mockDevelopers.map(dev => {
                const matchedSkills = dev.skills.filter(s => requiredSkills.includes(s));
                const skillScore = matchedSkills.length;
                const cost = roleCost[dev.role] || 1;
                const worthScore = (skillScore + 1) / cost;
                return { ...dev, matchedSkills, worthScore };
            });
            scoredDevs.sort((a, b) => b.worthScore - a.worthScore);
            
            state.recommendedTeam = scoredDevs.slice(0, 5);
            console.log("LOG: [generateTeam] Calculation complete. Rendering results.", state.recommendedTeam);
            render(); // Re-render the page with the results.
        } catch (error) {
            console.error("LOG: [generateTeam] An error occurred during calculation.", error);
        }
    }

    // --- RENDER & EVENT HANDLING ---
    const render = () => {
        const app = document.getElementById('app');
        if (!app.innerHTML) {
            app.innerHTML = AppShellHTML;
            themeManager.bind(document.getElementById('theme-toggle'));
            
            // --- ALL EVENT LISTENERS ARE ATTACHED ONCE HERE using Event Delegation ---
            app.addEventListener('click', (e) => { 
                const navLink = e.target.closest('.nav-link');
                if (navLink) { 
                    e.preventDefault(); 
                    state.currentPage = navLink.dataset.page; 
                    state.selectedProject = null;
                    state.recommendedTeam = null; 
                    if(state.currentPage !== 'ai-chat') {state.chatHistory = []}; 
                    render(); 
                }
                const projectCard = e.target.closest('.project-card');
                if (projectCard) {
                    const projectId = parseInt(projectCard.dataset.projectId, 10);
                    state.selectedProject = mockProjects.find(p => p.id === projectId);
                    state.currentPage = 'project-detail';
                    render();
                }
                const backButton = e.target.closest('#back-to-hub');
                if (backButton) {
                    state.currentPage = 'hub';
                    state.selectedProject = null;
                    render();
                }
                const teamPromptButton = e.target.closest('.team-prompt-button');
                if (teamPromptButton) {
                    const promptKey = teamPromptButton.dataset.promptKey;
                    const description = predefinedProjects[promptKey];
                    document.getElementById('project-description-input').value = description;
                    generateTeam(description);
                }
                 const chatPromptButton = e.target.closest('.pre-chat-prompts .prompt-button:not(.team-prompt-button)');
                if (chatPromptButton) {
                    handleChatMessage(chatPromptButton.textContent);
                }
            });
            
            app.addEventListener('submit', (e) => { 
                if (e.target.id === 'search-form') { 
                    e.preventDefault(); 
                    const term = document.getElementById('search-input').value.trim(); 
                    if (!term) return; 
                    state.searchTerm = term; state.searchResults = { experts: mockDevelopers.filter(d => d.skills.some(s => s.toLowerCase().includes(term.toLowerCase())) || d.name.toLowerCase().includes(term.toLowerCase())), lessons: mockProjects.flatMap(p => p.lessons.filter(l => l.title.toLowerCase().includes(term.toLowerCase()) || l.details.toLowerCase().includes(term.toLowerCase())).map(l => ({ ...l, projectName: p.name }))) }; state.currentPage = 'ai-assistant'; render(); 
                }
                if (e.target.id === 'team-builder-form') {
                    e.preventDefault();
                    const description = document.getElementById('project-description-input').value;
                    generateTeam(description);
                }
                if (e.target.id === 'chat-form') {
                    e.preventDefault();
                    const input = document.getElementById('chat-input');
                    handleChatMessage(input.value);
                    input.value = '';
                }
            });
        }
        
        let pageHtml = '';
        switch (state.currentPage) {
            case 'hub': pageHtml = ProjectHubPage(); break;
            case 'developer-dashboard': pageHtml = DeveloperDashboardPage(); break;
            case 'ai-assistant': pageHtml = AiAssistantPage(); break;
            case 'ai-chat': pageHtml = AiChatPage(); break;
            case 'team-builder': pageHtml = TeamBuilderPage(); break;
            case 'project-detail': pageHtml = ProjectDetailPage(state.selectedProject); break;
            default: pageHtml = ProjectHubPage();
        }
        document.getElementById('page-content').innerHTML = pageHtml;
        
        document.querySelectorAll('.nav-link').forEach(link => link.classList.toggle('active', link.dataset.page === state.currentPage));

        // Page specific initial renders
        if (state.currentPage === 'ai-chat') {
            renderChatView();
        }
        
        lucide.createIcons();
        themeManager.updateIcon(document.body.classList.contains('dark-theme') ? 'dark' : 'light');
    };

    document.addEventListener('DOMContentLoaded', () => {
        themeManager.init();
        render();
    });
    </script>
</body>
</html>
